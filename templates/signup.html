<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='logo.png') }}">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
    <script src="{{ url_for('static', filename='custom.js') }}"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='custom.css') }}">
  <style>
    :root {
      --pink-primary: #E91E63;
      --pink-light: #FFE8F0;
      --pink-background: #CC1454;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    nav {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: black;
      font-weight: 500;
      font-size: 16px;
    }

    .logo img {
      height: 38px;
      width: auto;
    }

    .nav-links {
      display: flex;
      gap: 20px;
    }

    .nav-links a {
      text-decoration: none;
      color: #666;
      padding-bottom: 4px;
    }

    .nav-links a.active {
      color: var(--pink-primary);
      border-bottom: 2px solid var(--pink-primary);
    }

    .container {
      display: flex;
      gap: 40px;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Biometric Section */
    .biometric-section {
      flex: 1;
      border: 1px solid #ef7096;
      border-radius: 8px;
    }

    .biometric-title {
      background: white;
      padding: 20px;
      border-radius: 8px 8px 0 0;
      text-align: center;
      font-size: 24px;
    }

    .camera-container {
      background: white;
      padding: 20px;
      border-top: 1px solid #ef7096;
    }

    .camera-box {
      background: var(--pink-light);
      height: 200px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .form-container {
      background: #e30045;
      padding: 20px;
      border-radius: 0 0 8px 8px;
      color: white;
    }
    .regular-title {
      background: #e30045;
      padding:5px;
      text-align: center;
      font-size: 24px;
      margin-bottom:80px;
    }

    /* Regular Section */
    .regular-section {
      flex: 1;
      padding: 20px;
      border-radius: 8px;
      background: #e30045;
      color: white;
    }


    .input-with-icon {
      position: relative;
      margin-bottom: 30px;
      margin-top:30px;
    }

    .input-with-icon input {
      width: 100%;
      padding: 12px;
      padding-left: 35px;
      border: none;
      border-radius: 4px;
      box-sizing: border-box;
      background: white;
    }

    .input-with-icon i {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
    }

    .password-input {
      padding-right: 35px !important;
    }

    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      background: none;
      border: none;
      color: #666;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
    }

    .form-group input {
      width: 100%;
      padding: 8px;
      border: none;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .sign-in-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      background: white;
      color: #d02258;
    }

    .reset-password {
      text-align: right;
      margin-bottom: 15px;
    }

    .reset-password a {
      color: white;
      text-decoration: none;
    }

    .register-link {
      text-align: center;
      margin-top:150px;
    }

    .register-link a {
      color: white;
      text-decoration: none;
      border-bottom: 1px solid white;
    }
  </style>
</head>
<body>
  <nav>
    <a href="#" class="logo">
      <img src="{{url_for('static',filename='logo.png')}}" alt="EqualEdge Logo">
      <span>EqualEdge</span>
    </a>
    <div class="nav-links">
      <a href="{{url_for('home')}}" class="active">Home</a>
      <a href="#">Classrooms</a>
      <a href="#">To do</a>

    </div>
  </nav>



  <div class="container">
    <!-- Biometric Sign-In Section -->
    <div class="biometric-section" id="biometric-section">
      <div class="biometric-title">Biometric Sign in</div>
      <div class="camera-container">
        <div class="camera-box">
          <video id="video" width="320" height="240" autoplay></video>
        </div>
      </div>
      <div class="form-container">
        <div class="form-group">
          <label>Name:</label>
          <input type="text" name="name" id="biometric-name" placeholder="Enter your name">
        </div>
        <div class="form-group">
          <label>Age:</label>
          <input type="number" name="age" id="biometric-age" placeholder="Enter your age">
        </div>
        <div class="form-group">
          <label>USN:</label>
          <input type="text" name="usn" id="biometric-usn" placeholder="Enter your USN">
        </div>
        <div class="form-group">
          <label>Name of Institution:</label>
          <input type="text" name="institution" id="biometric-institution" placeholder="Enter institution name">
        </div>
      </div>
      <button class="sign-in-btn" id="biometric-login-btn">Biometric Sign in</button>
      <div id="status">Waiting for face detection...</div>
    </div>

    <!-- Regular Sign-In Section -->
    <div class="regular-section" id="regular-section">
      <div class="regular-title">Regular Sign in</div>
      <div class="form-container">
        <div class="form-group">
          <label>Name:</label>
          <input type="text" name="name" id="regular-name" placeholder="Enter your name">
        </div>
        <div class="form-group">
          <label>Email:</label>
          <input type="email" name="email" id="regular-email" placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label>Password:</label>
          <input type="password" name="password" id="regular-password" placeholder="Enter your password">
        </div>
      </div>
      <button class="sign-in-btn" id="regular-login-btn">Regular Sign in</button>
    </div>
  </div>
  <div class="settings-container">
    <div class="settings-btn" onclick="toggleDropdown('fontDropdown')">Font</div>
    <div class="dropdown" id="fontDropdown">
        <button onclick="setFont('Arial')">Arial</button>
        <button onclick="setFont('Courier New')">Courier New</button>
        <button onclick="setFont('Georgia')">Georgia</button>
    </div>

    <div class="settings-btn" onclick="toggleSlider('fontSizeSlider')">Font Size</div>
    <div class="slider" id="fontSizeSlider">
        <input type="range" min="10" max="50" value="16" onchange="setFontSize(this.value)">
        <p>Font Size: <span id="fontSizeValue">16px</span></p>
    </div>

    <div class="settings-btn" onclick="toggleSlider('contrastSlider')">Contrast</div>
    <div class="slider" id="contrastSlider">
        <input type="range" min="0.5" max="2" value="1" step="0.1" onchange="setContrast(this.value)">
        <p>Contrast: <span id="contrastValue">1</span></p>
    </div>
</div>
<script>
  let video = document.getElementById('video');
let photoData = document.getElementById('photo-data');

Promise.all([
    faceapi.nets.ssdMobilenetv1.loadFromUri('/static/models'),
    faceapi.nets.faceLandmark68Net.loadFromUri('/static/models'),
    faceapi.nets.faceRecognitionNet.loadFromUri('/static/models')
]).then(startVideo);

function startVideo() {
    navigator.mediaDevices.getUserMedia({ video: {} })
        .then((stream) => {
            video.srcObject = stream;
        }).catch(err => console.error('Error starting video stream: ', err));
}

video.addEventListener('play', () => {
    setInterval(async () => {
        const detections = await faceapi.detectAllFaces(video)
            .withFaceLandmarks()
            .withFaceDescriptors();
        
        if (detections.length > 0) {
            const imageData = detections[0].descriptor;  // Capture the first detected face descriptor
            
            // Convert image to base64 and store in the hidden input field
            const canvas = faceapi.createCanvasFromMedia(video);
            const dataUrl = canvas.toDataURL();
            photoData.value = dataUrl;  // Set captured image as base64
            
            document.getElementById('status').innerText = "Face detected!";
        } else {
            document.getElementById('status').innerText = "Waiting for face detection...";
        }
    }, 100);
});

</script>
<script>
  let recognition;
  let pauseTimer;
  
  function initializeSpeechRecognition() {
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.interimResults = false; // Don't show partial results
      recognition.maxAlternatives = 1; // Only accept the best alternative
      recognition.continuous = false;
  
      // When speech recognition result is available
      recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          console.log('Recognized command:', transcript);
          console.log(transcript)
  
          // Send the recognized command to the backend for processing
          fetch('/process_command', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ command: transcript })
          })
          .then(response => response.json())
          .then(data => {
              window.location.href = data.redirect_url;  // Redirect to the URL received from the backend
          })
          .catch(err => console.error('Error:', err));
      };
  
      // Handle errors
      recognition.onerror = function(event) {
          console.error('Error occurred in recognition:', event.error);
      };
  
      // Restart recognition on end to handle longer speech
      recognition.onend = function() {
          if (!pauseTimer) recognition.start();
      };
  }
  
  document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
          event.preventDefault();  // Prevent default Escape behavior
          if (!recognition) initializeSpeechRecognition();  // Initialize if not already done
          recognition.start();  // Start speech recognition
  
          // Apply flickering effect on the button when speech recognition starts
          document.getElementById('anvaya-item').classList.add('flickering');
          console.log("Speech recognition started.");
      }
  });
  
  // Submit the recognized command if no new input for 5 seconds
  function resetPauseTimer() {
      if (pauseTimer) clearTimeout(pauseTimer);  // Clear any existing timer
      pauseTimer = setTimeout(() => {
          recognition.stop();  // Stop recognition after 5 seconds of inactivity
  
          // Remove flickering effect from the button when recognition stops
          document.getElementById('anvaya-item').classList.remove('flickering');
      }, 5000);  // 5 seconds pause
  }
  
  // Detect speech input pauses
  recognition.onaudiostart = resetPauseTimer;  // Reset the timer when speech starts
  recognition.onend = resetPauseTimer;  // Reset the timer when speech ends
  

</script>
</body>
</html>